<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registronet - Sistema de Gestión Docente</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .glass-effect { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .animate-fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .status-badge { transition: all 0.2s; cursor: pointer; }
        .status-badge:hover { transform: scale(1.1); }
        .hidden-section { display: none; }
        .active-nav { border-bottom: 3px solid #667eea; color: #667eea; }
        .periodo-tab.active { background-color: #667eea; color: white; }
        input[type="number"]::-webkit-inner-spin-button, input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="text-gray-800">

    <!-- Login Screen -->
    <div id="loginScreen" class="fixed inset-0 gradient-bg flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-md animate-fade-in">
            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-gradient-to-br from-blue-400 to-purple-600 rounded-2xl mx-auto flex items-center justify-center mb-4 shadow-lg">
                    <i class="fas fa-graduation-cap text-4xl text-white"></i>
                </div>
                <h1 class="text-3xl font-bold text-gray-800">Registronet</h1>
                <p class="text-gray-500 mt-2">Sistema de Gestión Docente</p>
            </div>
            <form id="loginForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Correo Electrónico</label>
                    <input type="email" id="loginEmail" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition" placeholder="profesor@escuela.edu" value="profesor@registronet.com">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Contraseña</label>
                    <input type="password" id="loginPassword" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition" placeholder="••••••••" value="password">
                </div>
                <button type="submit" class="w-full gradient-bg text-white py-3 rounded-lg font-semibold hover:opacity-90 transition transform hover:scale-[1.02]">
                    Iniciar Sesión
                </button>
            </form>
            <div class="mt-6 text-center text-sm text-gray-500">
                <p>Demo: cualquier correo/contraseña funciona</p>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="hidden">
        <!-- Navigation -->
        <nav class="glass-effect fixed w-full top-0 z-40 shadow-sm">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex items-center">
                        <div class="flex-shrink-0 flex items-center gap-3 cursor-pointer" onclick="showSection('dashboard')">
                            <div class="w-10 h-10 bg-gradient-to-br from-blue-400 to-purple-600 rounded-lg flex items-center justify-center">
                                <i class="fas fa-graduation-cap text-white text-xl"></i>
                            </div>
                            <span class="font-bold text-xl text-gray-800">Registronet</span>
                        </div>
                        <div class="hidden md:ml-10 md:flex md:space-x-8">
                            <button onclick="showSection('dashboard')" id="nav-dashboard" class="active-nav px-3 py-2 text-sm font-medium text-gray-900 inline-flex items-center gap-2">
                                <i class="fas fa-home"></i> Inicio
                            </button>
                            <button onclick="showSection('secciones')" id="nav-secciones" class="px-3 py-2 text-sm font-medium text-gray-500 hover:text-gray-900 inline-flex items-center gap-2">
                                <i class="fas fa-chalkboard"></i> Secciones
                            </button>
                            <button onclick="showSection('horario')" id="nav-horario" class="px-3 py-2 text-sm font-medium text-gray-500 hover:text-gray-900 inline-flex items-center gap-2">
                                <i class="fas fa-clock"></i> Horario
                            </button>
                            <button onclick="showSection('reportes')" id="nav-reportes" class="px-3 py-2 text-sm font-medium text-gray-500 hover:text-gray-900 inline-flex items-center gap-2">
                                <i class="fas fa-file-alt"></i> Reportes
                            </button>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <button onclick="showSection('bitacoras')" class="text-gray-500 hover:text-gray-700 relative">
                            <i class="fas fa-book"></i>
                            <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center" id="bitacoraCount">0</span>
                        </button>
                        <div class="flex items-center gap-2">
                            <img src="https://ui-avatars.com/api/?name=Profesor&background=667eea&color=fff" class="w-8 h-8 rounded-full">
                            <span class="hidden md:block text-sm font-medium text-gray-700" id="userName">Profesor</span>
                            <button onclick="logout()" class="text-gray-400 hover:text-red-500 ml-2">
                                <i class="fas fa-sign-out-alt"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="pt-20 pb-10 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto">
            
            <!-- Dashboard -->
            <section id="dashboard" class="animate-fade-in">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900">Panel de Control</h2>
                    <p class="text-gray-600 mt-1">Bienvenido de vuelta, <span id="welcomeName">Profesor</span></p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Total Secciones</p>
                                <p class="text-2xl font-bold text-gray-900" id="totalSecciones">0</p>
                            </div>
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center text-blue-600">
                                <i class="fas fa-chalkboard text-xl"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Total Estudiantes</p>
                                <p class="text-2xl font-bold text-gray-900" id="totalEstudiantes">0</p>
                            </div>
                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center text-green-600">
                                <i class="fas fa-users text-xl"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Evaluaciones Hoy</p>
                                <p class="text-2xl font-bold text-gray-900" id="evaluacionesHoy">0</p>
                            </div>
                            <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600">
                                <i class="fas fa-clipboard-check text-xl"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Asistencia Promedio</p>
                                <p class="text-2xl font-bold text-gray-900" id="asistenciaPromedio">0%</p>
                            </div>
                            <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center text-orange-600">
                                <i class="fas fa-chart-line text-xl"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Acceso Rápido</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <button onclick="showSection('secciones'); openModal('nuevaSeccionModal')" class="p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition text-center group">
                                <i class="fas fa-plus-circle text-3xl text-gray-400 group-hover:text-purple-500 mb-2"></i>
                                <p class="text-sm font-medium text-gray-700">Nueva Sección</p>
                            </button>
                            <button onclick="showSection('horario')" class="p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition text-center group">
                                <i class="fas fa-clock text-3xl text-gray-400 group-hover:text-blue-500 mb-2"></i>
                                <p class="text-sm font-medium text-gray-700">Ver Horario</p>
                            </button>
                            <button onclick="showSection('reportes')" class="p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-green-500 hover:bg-green-50 transition text-center group">
                                <i class="fas fa-file-export text-3xl text-gray-400 group-hover:text-green-500 mb-2"></i>
                                <p class="text-sm font-medium text-gray-700">Exportar Reportes</p>
                            </button>
                            <button onclick="showSection('bitacoras')" class="p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-orange-500 hover:bg-orange-50 transition text-center group">
                                <i class="fas fa-book-open text-3xl text-gray-400 group-hover:text-orange-500 mb-2"></i>
                                <p class="text-sm font-medium text-gray-700">Nueva Bitácora</p>
                            </button>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Próximas Clases</h3>
                        <div id="proximasClases" class="space-y-3">
                            <!-- Dynamic content -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Secciones -->
            <section id="secciones" class="hidden-section animate-fade-in">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-900">Mis Secciones</h2>
                        <p class="text-gray-600">Gestiona tus grupos y estudiantes</p>
                    </div>
                    <button onclick="openModal('nuevaSeccionModal')" class="gradient-bg text-white px-6 py-3 rounded-lg font-medium hover:opacity-90 transition flex items-center gap-2">
                        <i class="fas fa-plus"></i> Nueva Sección
                    </button>
                </div>

                <div id="seccionesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Dynamic secciones -->
                </div>
            </section>

            <!-- Detalle Sección -->
            <section id="detalleSeccion" class="hidden-section animate-fade-in">
                <button onclick="showSection('secciones')" class="mb-4 text-gray-600 hover:text-gray-900 flex items-center gap-2">
                    <i class="fas fa-arrow-left"></i> Volver a Secciones
                </button>
                
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6">
                    <div class="flex justify-between items-start">
                        <div>
                            <h2 class="text-3xl font-bold text-gray-900" id="detalleTitulo">Matemáticas</h2>
                            <p class="text-gray-600 mt-1" id="detalleSubtitulo">Sección 6-2 • Escuela República de Francia</p>
                            <div class="flex gap-2 mt-3">
                                <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium" id="detallePeriodo">I Periodo</span>
                                <span class="px-3 py-1 bg-gray-100 text-gray-800 rounded-full text-sm font-medium" id="detalleCantidad">0 estudiantes</span>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="openModal('nuevoEstudianteModal')" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition flex items-center gap-2">
                                <i class="fas fa-user-plus"></i> Agregar Estudiante
                            </button>
                            <button onclick="eliminarSeccionActual()" class="px-4 py-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 mb-6">
                    <div class="border-b border-gray-200">
                        <nav class="flex -mb-px">
                            <button onclick="cambiarTab('estudiantes')" id="tab-estudiantes" class="tab-btn active-nav px-6 py-4 text-sm font-medium border-b-2 border-purple-500 text-purple-600">
                                <i class="fas fa-users mr-2"></i>Estudiantes
                            </button>
                            <button onclick="cambiarTab('asistencia')" id="tab-asistencia" class="tab-btn px-6 py-4 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700">
                                <i class="fas fa-check-circle mr-2"></i>Asistencia
                            </button>
                            <button onclick="cambiarTab('evaluaciones')" id="tab-evaluaciones" class="tab-btn px-6 py-4 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700">
                                <i class="fas fa-clipboard-list mr-2"></i>Evaluaciones
                            </button>
                            <button onclick="cambiarTab('reporte')" id="tab-reporte" class="tab-btn px-6 py-4 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700">
                                <i class="fas fa-chart-bar mr-2"></i>Reporte Final
                            </button>
                        </nav>
                    </div>

                    <div class="p-6">
                        <!-- Estudiantes Tab -->
                        <div id="content-estudiantes" class="tab-content">
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">#</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estudiante</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ACS</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Promedio</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tablaEstudiantes" class="bg-white divide-y divide-gray-200">
                                        <!-- Dynamic -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Asistencia Tab -->
                        <div id="content-asistencia" class="tab-content hidden">
                            <div class="mb-4 flex justify-between items-center">
                                <div class="flex gap-2">
                                    <button onclick="cambiarPeriodoAsistencia('I')" class="periodo-tab active px-4 py-2 rounded-lg text-sm font-medium bg-gray-200 text-gray-700 hover:bg-gray-300">I Periodo</button>
                                    <button onclick="cambiarPeriodoAsistencia('II')" class="periodo-tab px-4 py-2 rounded-lg text-sm font-medium bg-gray-200 text-gray-700 hover:bg-gray-300">II Periodo</button>
                                    <button onclick="cambiarPeriodoAsistencia('III')" class="periodo-tab px-4 py-2 rounded-lg text-sm font-medium bg-gray-200 text-gray-700 hover:bg-gray-300">III Periodo</button>
                                </div>
                                <button onclick="registrarAsistenciaHoy()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition">
                                    <i class="fas fa-calendar-check mr-2"></i>Registrar Hoy
                                </button>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200" id="tablaAsistencia">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Estudiante</th>
                                            <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">L</th>
                                            <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">M</th>
                                            <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">X</th>
                                            <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">J</th>
                                            <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">V</th>
                                            <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">Total</th>
                                        </tr>
                                    </thead>
                                    <tbody id="bodyAsistencia" class="bg-white divide-y divide-gray-200">
                                        <!-- Dynamic -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Evaluaciones Tab -->
                        <div id="content-evaluaciones" class="tab-content hidden">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                                <div onclick="abrirEvaluacion('trabajo')" class="cursor-pointer bg-blue-50 border-2 border-blue-200 rounded-xl p-6 hover:border-blue-400 hover:bg-blue-100 transition text-center">
                                    <i class="fas fa-briefcase text-4xl text-blue-600 mb-3"></i>
                                    <h4 class="font-semibold text-gray-900">Trabajo Cotidiano</h4>
                                    <p class="text-sm text-gray-600 mt-1" id="countTrabajo">0 registros</p>
                                </div>
                                <div onclick="abrirEvaluacion('tareas')" class="cursor-pointer bg-green-50 border-2 border-green-200 rounded-xl p-6 hover:border-green-400 hover:bg-green-100 transition text-center">
                                    <i class="fas fa-home text-4xl text-green-600 mb-3"></i>
                                    <h4 class="font-semibold text-gray-900">Tareas</h4>
                                    <p class="text-sm text-gray-600 mt-1" id="countTareas">0 registros</p>
                                </div>
                                <div onclick="abrirEvaluacion('pruebas')" class="cursor-pointer bg-purple-50 border-2 border-purple-200 rounded-xl p-6 hover:border-purple-400 hover:bg-purple-100 transition text-center">
                                    <i class="fas fa-file-alt text-4xl text-purple-600 mb-3"></i>
                                    <h4 class="font-semibold text-gray-900">Pruebas</h4>
                                    <p class="text-sm text-gray-600 mt-1" id="countPruebas">0 registros</p>
                                </div>
                            </div>
                            
                            <div id="formularioEvaluacion" class="hidden bg-gray-50 rounded-xl p-6 border border-gray-200">
                                <h4 class="font-semibold text-lg mb-4" id="tituloEvalForm">Nueva Evaluación</h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                    <input type="text" id="nombreEvaluacion" placeholder="Nombre de la evaluación" class="px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none">
                                    <input type="date" id="fechaEvaluacion" class="px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none">
                                    <input type="number" id="porcentajeEvaluacion" placeholder="%" class="px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none" min="0" max="100">
                                </div>
                                <div id="listaNotasEstudiantes" class="space-y-2 max-h-96 overflow-y-auto">
                                    <!-- Dynamic inputs for grades -->
                                </div>
                                <div class="mt-4 flex justify-end gap-2">
                                    <button onclick="cancelarEvaluacion()" class="px-4 py-2 text-gray-600 hover:text-gray-800">Cancelar</button>
                                    <button onclick="guardarEvaluacion()" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">Guardar Notas</button>
                                </div>
                            </div>
                        </div>

                        <!-- Reporte Tab -->
                        <div id="content-reporte" class="tab-content hidden">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-lg font-semibold">Reporte Final del Periodo</h3>
                                <div class="flex gap-2">
                                    <button onclick="generarReportePDF()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 flex items-center gap-2">
                                        <i class="fas fa-file-pdf"></i> PDF
                                    </button>
                                    <button onclick="generarReporteExcel()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center gap-2">
                                        <i class="fas fa-file-excel"></i> Excel
                                    </button>
                                </div>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200" id="tablaReporteFinal">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">#</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Estudiante</th>
                                            <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">T.Cotidiano</th>
                                            <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">Tareas</th>
                                            <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">Pruebas</th>
                                            <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">Promedio</th>
                                            <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">Asistencia</th>
                                        </tr>
                                    </thead>
                                    <tbody id="bodyReporteFinal" class="bg-white divide-y divide-gray-200">
                                        <!-- Dynamic -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Horario -->
            <section id="horario" class="hidden-section animate-fade-in">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-gray-900">Horario de Clases</h2>
                    <button onclick="openModal('nuevaClaseModal')" class="gradient-bg text-white px-6 py-3 rounded-lg font-medium hover:opacity-90 transition">
                        <i class="fas fa-plus mr-2"></i>Agregar Clase
                    </button>
                </div>
                
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                    <div class="grid grid-cols-6 border-b border-gray-200 bg-gray-50 font-medium text-gray-700">
                        <div class="p-4 border-r border-gray-200">Hora</div>
                        <div class="p-4 border-r border-gray-200">Lunes</div>
                        <div class="p-4 border-r border-gray-200">Martes</div>
                        <div class="p-4 border-r border-gray-200">Miércoles</div>
                        <div class="p-4 border-r border-gray-200">Jueves</div>
                        <div class="p-4">Viernes</div>
                    </div>
                    <div id="horarioGrid" class="divide-y divide-gray-200">
                        <!-- Dynamic horario -->
                    </div>
                </div>
            </section>

            <!-- Reportes -->
            <section id="reportes" class="hidden-section animate-fade-in">
                <h2 class="text-3xl font-bold text-gray-900 mb-6">Generar Reportes</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 card-hover">
                        <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center text-red-600 mb-4">
                            <i class="fas fa-file-pdf text-2xl"></i>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">Reporte Individual PDF</h3>
                        <p class="text-gray-600 text-sm mb-4">Genera reportes detallados por estudiante en formato PDF.</p>
                        <select id="selectReporteEstudiante" class="w-full mb-3 px-3 py-2 border rounded-lg">
                            <option value="">Seleccionar estudiante...</option>
                        </select>
                        <button onclick="generarReporteIndividualPDF()" class="w-full px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">
                            Descargar PDF
                        </button>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 card-hover">
                        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center text-green-600 mb-4">
                            <i class="fas fa-file-excel text-2xl"></i>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">Exportar a Excel</h3>
                        <p class="text-gray-600 text-sm mb-4">Exporta todas las notas y asistencias a Excel.</p>
                        <select id="selectReporteSeccion" class="w-full mb-3 px-3 py-2 border rounded-lg">
                            <option value="">Seleccionar sección...</option>
                        </select>
                        <button onclick="exportarExcel()" class="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
                            Descargar Excel
                        </button>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 card-hover">
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center text-blue-600 mb-4">
                            <i class="fas fa-file-csv text-2xl"></i>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">Formato SEA</h3>
                        <p class="text-gray-600 text-sm mb-4">Genera archivo CSV compatible con el sistema SEA.</p>
                        <button onclick="generarCSV()" class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                            Descargar CSV
                        </button>
                    </div>
                </div>
            </section>

            <!-- Bitácoras -->
            <section id="bitacoras" class="hidden-section animate-fade-in">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-gray-900">Bitácoras y Recordatorios</h2>
                    <button onclick="openModal('nuevaBitacoraModal')" class="gradient-bg text-white px-6 py-3 rounded-lg font-medium hover:opacity-90 transition">
                        <i class="fas fa-plus mr-2"></i>Nueva Entrada
                    </button>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2 space-y-4" id="listaBitacoras">
                        <!-- Dynamic bitacoras -->
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 h-fit">
                        <h3 class="font-semibold text-gray-900 mb-4">Recordatorios</h3>
                        <div id="listaRecordatorios" class="space-y-3">
                            <p class="text-gray-500 text-sm italic">No hay recordatorios pendientes</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modals -->
    
    <!-- Nueva Sección -->
    <div id="nuevaSeccionModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 animate-fade-in">
            <h3 class="text-2xl font-bold text-gray-900 mb-4">Nueva Sección</h3>
            <form id="formNuevaSeccion" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Asignatura</label>
                    <input type="text" id="seccionAsignatura" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none" placeholder="Ej: Matemáticas">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Sección/Grupo</label>
                    <input type="text" id="seccionGrupo" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none" placeholder="Ej: 6-2">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Institución</label>
                    <input type="text" id="seccionInstitucion" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none" placeholder="Ej: Escuela República de Francia">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Año Lectivo</label>
                    <input type="number" id="seccionAnio" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none" value="2025">
                </div>
                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" onclick="closeModal('nuevaSeccionModal')" class="px-4 py-2 text-gray-600 hover:text-gray-800">Cancelar</button>
                    <button type="submit" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">Crear Sección</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Nuevo Estudiante -->
    <div id="nuevoEstudianteModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 animate-fade-in">
            <h3 class="text-2xl font-bold text-gray-900 mb-4">Agregar Estudiante</h3>
            <form id="formNuevoEstudiante" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Nombre Completo</label>
                    <input type="text" id="estNombre" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none">
                </div>
                <div class="flex items-center gap-2">
                    <input type="checkbox" id="estACS" class="w-4 h-4 text-purple-600 rounded">
                    <label for="estACS" class="text-sm text-gray-700">¿Adecuación Curricular Significativa (ACS)?</label>
                </div>
                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" onclick="closeModal('nuevoEstudianteModal')" class="px-4 py-2 text-gray-600 hover:text-gray-800">Cancelar</button>
                    <button type="submit" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">Agregar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Nueva Bitácora -->
    <div id="nuevaBitacoraModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl p-8 max-w-lg w-full mx-4 animate-fade-in">
            <h3 class="text-2xl font-bold text-gray-900 mb-4">Nueva Bitácora</h3>
            <form id="formBitacora" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Título</label>
                    <input type="text" id="bitacoraTitulo" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Sección</label>
                    <select id="bitacoraSeccion" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none">
                        <!-- Dynamic -->
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Contenido</label>
                    <textarea id="bitacoraContenido" rows="4" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none"></textarea>
                </div>
                <div class="flex items-center gap-2">
                    <input type="checkbox" id="bitacoraRecordatorio" class="w-4 h-4 text-purple-600 rounded">
                    <label for="bitacoraRecordatorio" class="text-sm text-gray-700">¿Establecer recordatorio?</label>
                </div>
                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" onclick="closeModal('nuevaBitacoraModal')" class="px-4 py-2 text-gray-600 hover:text-gray-800">Cancelar</button>
                    <button type="submit" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Nueva Clase (Horario) -->
    <div id="nuevaClaseModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 animate-fade-in">
            <h3 class="text-2xl font-bold text-gray-900 mb-4">Agregar Clase al Horario</h3>
            <form id="formNuevaClase" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Sección</label>
                    <select id="claseSeccion" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none">
                        <!-- Dynamic -->
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Día</label>
                    <select id="claseDia" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none">
                        <option value="1">Lunes</option>
                        <option value="2">Martes</option>
                        <option value="3">Miércoles</option>
                        <option value="4">Jueves</option>
                        <option value="5">Viernes</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Hora Inicio</label>
                    <input type="time" id="claseHoraInicio" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Hora Fin</label>
                    <input type="time" id="claseHoraFin" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none">
                </div>
                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" onclick="closeModal('nuevaClaseModal')" class="px-4 py-2 text-gray-600 hover:text-gray-800">Cancelar</button>
                    <button type="submit" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">Agregar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Data Store
        let data = {
            user: { name: 'Profesor', email: '' },
            secciones: [],
            horario: [],
            bitacoras: [],
            currentSeccion: null,
            currentTab: 'estudiantes',
            currentPeriodo: 'I',
            currentEvalType: null
        };

        // Initialize with sample data
        function initSampleData() {
            data.secciones = [
                {
                    id: 1,
                    asignatura: 'Matemáticas',
                    seccion: '6-2',
                    institucion: 'Escuela República de Francia',
                    anio: 2025,
                    estudiantes: [
                        { id: 1, nombre: 'María González', acs: false, notas: { trabajo: [85, 90], tareas: [100, 95], pruebas: [88] }, asistencia: { 'I': { '2025-02-10': 'P', '2025-02-11': 'P', '2025-02-12': 'T' } } },
                        { id: 2, nombre: 'Juan Pérez', acs: false, notas: { trabajo: [78, 82], tareas: [90, 85], pruebas: [75] }, asistencia: { 'I': { '2025-02-10': 'P', '2025-02-11': 'A' } } },
                        { id: 3, nombre: 'Ana Martínez', acs: true, notas: { trabajo: [95], tareas: [100], pruebas: [92] }, asistencia: { 'I': { '2025-02-10': 'P', '2025-02-11': 'P' } } }
                    ],
                    evaluaciones: []
                },
                {
                    id: 2,
                    asignatura: 'Ciencias',
                    seccion: '6-2',
                    institucion: 'Escuela República de Francia',
                    anio: 2025,
                    estudiantes: [
                        { id: 4, nombre: 'Carlos Ruiz', acs: false, notas: { trabajo: [88], tareas: [90], pruebas: [85] }, asistencia: { 'I': {} } }
                    ],
                    evaluaciones: []
                }
            ];
            
            data.horario = [
                { id: 1, seccionId: 1, dia: 1, horaInicio: '07:00', horaFin: '08:30', asignatura: 'Matemáticas', seccion: '6-2' },
                { id: 2, seccionId: 1, dia: 3, horaInicio: '09:00', horaFin: '10:30', asignatura: 'Matemáticas', seccion: '6-2' },
                { id: 3, seccionId: 2, dia: 2, horaInicio: '07:00', horaFin: '08:30', asignatura: 'Ciencias', seccion: '6-2' }
            ];

            updateDashboard();
            renderSecciones();
            renderHorario();
            updateSelects();
        }

        // Auth
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            data.user.email = email;
            data.user.name = email.split('@')[0];
            document.getElementById('userName').textContent = data.user.name;
            document.getElementById('welcomeName').textContent = data.user.name;
            
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            initSampleData();
        });

        function logout() {
            location.reload();
        }

        // Navigation
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('main > section').forEach(sec => {
                sec.classList.add('hidden-section');
            });
            
            // Show target
            document.getElementById(sectionId).classList.remove('hidden-section');
            
            // Update nav
            document.querySelectorAll('nav button[id^="nav-"]').forEach(btn => {
                btn.classList.remove('active-nav', 'text-gray-900');
                btn.classList.add('text-gray-500');
            });
            
            const navBtn = document.getElementById('nav-' + sectionId);
            if (navBtn) {
                navBtn.classList.add('active-nav', 'text-gray-900');
                navBtn.classList.remove('text-gray-500');
            }

            if (sectionId === 'dashboard') updateDashboard();
            if (sectionId === 'reportes') updateReportesSelects();
        }

        // Modals
        function openModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
            if (modalId === 'nuevaBitacoraModal' || modalId === 'nuevaClaseModal') updateSelects();
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        // Dashboard
        function updateDashboard() {
            document.getElementById('totalSecciones').textContent = data.secciones.length;
            const totalEst = data.secciones.reduce((acc, s) => acc + s.estudiantes.length, 0);
            document.getElementById('totalEstudiantes').textContent = totalEst;
            
            // Calculate asistencia promedio
            let totalAsist = 0, totalRegistros = 0;
            data.secciones.forEach(sec => {
                sec.estudiantes.forEach(est => {
                    const asist = est.asistencia[data.currentPeriodo] || {};
                    Object.values(asist).forEach(a => {
                        if (a === 'P') totalAsist++;
                        totalRegistros++;
                    });
                });
            });
            const prom = totalRegistros > 0 ? Math.round((totalAsist / totalRegistros) * 100) : 0;
            document.getElementById('asistenciaPromedio').textContent = prom + '%';

            // Próximas clases
            const hoy = new Date().getDay();
            const clasesHoy = data.horario.filter(h => h.dia === hoy).sort((a, b) => a.horaInicio.localeCompare(b.horaInicio));
            const container = document.getElementById('proximasClases');
            if (clasesHoy.length === 0) {
                container.innerHTML = '<p class="text-gray-500 italic">No hay clases programadas para hoy</p>';
            } else {
                container.innerHTML = clasesHoy.map(c => `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200">
                        <div>
                            <p class="font-medium text-gray-900">${c.asignatura} - ${c.seccion}</p>
                            <p class="text-sm text-gray-500">${c.horaInicio} - ${c.horaFin}</p>
                        </div>
                        <button onclick="irAAsistencia(${c.seccionId})" class="text-purple-600 hover:text-purple-800">
                            <i class="fas fa-check-circle text-xl"></i>
                        </button>
                    </div>
                `).join('');
            }
        }

        // Secciones
        function renderSecciones() {
            const grid = document.getElementById('seccionesGrid');
            if (data.secciones.length === 0) {
                grid.innerHTML = '<div class="col-span-full text-center py-12 text-gray-500">No hay secciones creadas. ¡Crea tu primera sección!</div>';
                return;
            }
            
            grid.innerHTML = data.secciones.map(sec => `
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 card-hover cursor-pointer" onclick="verDetalleSeccion(${sec.id})">
                    <div class="flex justify-between items-start mb-4">
                        <div class="w-12 h-12 bg-gradient-to-br from-blue-400 to-purple-600 rounded-lg flex items-center justify-center text-white font-bold text-xl">
                            ${sec.asignatura.charAt(0)}
                        </div>
                        <span class="text-sm text-gray-500">Año ${sec.anio}</span>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-1">${sec.asignatura}</h3>
                    <p class="text-gray-600 mb-3">Sección: ${sec.seccion}</p>
                    <p class="text-sm text-gray-500 mb-4">${sec.institucion}</p>
                    
                    <div class="flex gap-2 flex-wrap">
                        <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium">I Periodo</span>
                        <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium">${sec.estudiantes.length} estudiantes</span>
                    </div>
                    
                    <div class="mt-4 pt-4 border-t border-gray-100 flex gap-2">
                        <button class="flex-1 px-3 py-2 bg-blue-50 text-blue-600 rounded-lg text-sm hover:bg-blue-100 transition" onclick="event.stopPropagation(); verDetalleSeccion(${sec.id}); cambiarTab('asistencia')">
                            Asistencia
                        </button>
                        <button class="flex-1 px-3 py-2 bg-purple-50 text-purple-600 rounded-lg text-sm hover:bg-purple-100 transition" onclick="event.stopPropagation(); verDetalleSeccion(${sec.id}); cambiarTab('evaluaciones')">
                            Notas
                        </button>
                    </div>
                </div>
            `).join('');
        }

        document.getElementById('formNuevaSeccion').addEventListener('submit', function(e) {
            e.preventDefault();
            const nueva = {
                id: Date.now(),
                asignatura: document.getElementById('seccionAsignatura').value,
                seccion: document.getElementById('seccionGrupo').value,
                institucion: document.getElementById('seccionInstitucion').value,
                anio: parseInt(document.getElementById('seccionAnio').value),
                estudiantes: [],
                evaluaciones: []
            };
            data.secciones.push(nueva);
            closeModal('nuevaSeccionModal');
            this.reset();
            renderSecciones();
            updateDashboard();
            updateSelects();
        });

        // Detalle Sección
        function verDetalleSeccion(id) {
            data.currentSeccion = data.secciones.find(s => s.id === id);
            if (!data.currentSeccion) return;
            
            document.getElementById('detalleTitulo').textContent = data.currentSeccion.asignatura;
            document.getElementById('detalleSubtitulo').textContent = `Sección ${data.currentSeccion.seccion} • ${data.currentSeccion.institucion}`;
            document.getElementById('detalleCantidad').textContent = `${data.currentSeccion.estudiantes.length} estudiantes`;
            
            showSection('detalleSeccion');
            cambiarTab('estudiantes');
            renderEstudiantes();
        }

        function cambiarTab(tab) {
            data.currentTab = tab;
            
            // Update buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active-nav', 'border-purple-500', 'text-purple-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });
            document.getElementById('tab-' + tab).classList.add('active-nav', 'border-purple-500', 'text-purple-600');
            document.getElementById('tab-' + tab).classList.remove('border-transparent', 'text-gray-500');
            
            // Update content
            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
            document.getElementById('content-' + tab).classList.remove('hidden');
            
            if (tab === 'estudiantes') renderEstudiantes();
            if (tab === 'asistencia') renderAsistencia();
            if (tab === 'evaluaciones') renderEvaluaciones();
            if (tab === 'reporte') renderReporteFinal();
        }

        function renderEstudiantes() {
            const tbody = document.getElementById('tablaEstudiantes');
            if (data.currentSeccion.estudiantes.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="px-6 py-4 text-center text-gray-500">No hay estudiantes registrados</td></tr>';
                return;
            }
            
            tbody.innerHTML = data.currentSeccion.estudiantes.map((est, idx) => {
                const prom = calcularPromedio(est);
                return `
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${idx + 1}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 h-10 w-10">
                                <div class="h-10 w-10 rounded-full bg-gradient-to-br from-purple-400 to-blue-500 flex items-center justify-center text-white font-bold">
                                    ${est.nombre.charAt(0)}
                                </div>
                            </div>
                            <div class="ml-4">
                                <div class="text-sm font-medium text-gray-900">${est.nombre}</div>
                                ${est.acs ? '<span class="text-xs text-orange-600 font-medium">ACS</span>' : ''}
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        ${est.acs ? '<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-orange-100 text-orange-800">Sí</span>' : '<span class="text-gray-400">-</span>'}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-semibold">${prom.toFixed(1)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="eliminarEstudiante(${est.id})" class="text-red-600 hover:text-red-900"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `}).join('');
        }

        document.getElementById('formNuevoEstudiante').addEventListener('submit', function(e) {
            e.preventDefault();
            const nuevo = {
                id: Date.now(),
                nombre: document.getElementById('estNombre').value,
                acs: document.getElementById('estACS').checked,
                notas: { trabajo: [], tareas: [], pruebas: [] },
                asistencia: { 'I': {}, 'II': {}, 'III': {} }
            };
            data.currentSeccion.estudiantes.push(nuevo);
            closeModal('nuevoEstudianteModal');
            this.reset();
            renderEstudiantes();
            document.getElementById('detalleCantidad').textContent = `${data.currentSeccion.estudiantes.length} estudiantes`;
        });

        function eliminarEstudiante(id) {
            if (!confirm('¿Eliminar este estudiante?')) return;
            data.currentSeccion.estudiantes = data.currentSeccion.estudiantes.filter(e => e.id !== id);
            renderEstudiantes();
        }

        function eliminarSeccionActual() {
            if (!confirm('¿Eliminar esta sección permanentemente?')) return;
            data.secciones = data.secciones.filter(s => s.id !== data.currentSeccion.id);
            showSection('secciones');
            renderSecciones();
        }

        // Asistencia
        function cambiarPeriodoAsistencia(per) {
            data.currentPeriodo = per;
            document.querySelectorAll('.periodo-tab').forEach(btn => {
                btn.classList.remove('active', 'bg-purple-600', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            event.target.classList.add('active', 'bg-purple-600', 'text-white');
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
            renderAsistencia();
        }

        function renderAsistencia() {
            const tbody = document.getElementById('bodyAsistencia');
            const dias = ['L', 'M', 'X', 'J', 'V'];
            
            tbody.innerHTML = data.currentSeccion.estudiantes.map(est => {
                const asistPeriodo = est.asistencia[data.currentPeriodo] || {};
                const totalAsist = Object.values(asistPeriodo).filter(a => a === 'P').length;
                const total = Object.keys(asistPeriodo).length;
                const porc = total > 0 ? Math.round((totalAsist/total)*100) : 0;
                
                return `
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${est.nombre}</td>
                    ${dias.map((d, i) => {
                        const estado = asistPeriodo[d] || '';
                        const color = estado === 'P' ? 'bg-green-500' : estado === 'A' ? 'bg-red-500' : estado === 'T' ? 'bg-yellow-500' : 'bg-gray-200';
                        return `<td class="px-6 py-4 whitespace-nowrap text-center">
                            <button onclick="cambiarEstadoAsistencia(${est.id}, '${d}')" class="w-8 h-8 rounded-full ${color} text-white text-xs font-bold status-badge">
                                ${estado || '-'}
                            </button>
                        </td>`;
                    }).join('')}
                    <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-bold ${porc >= 80 ? 'text-green-600' : porc >= 60 ? 'text-yellow-600' : 'text-red-600'}">
                        ${porc}%
                    </td>
                </tr>
            `}).join('');
        }

        function cambiarEstadoAsistencia(estId, dia) {
            const est = data.currentSeccion.estudiantes.find(e => e.id === estId);
            if (!est.asistencia[data.currentPeriodo]) est.asistencia[data.currentPeriodo] = {};
            
            const estados = ['', 'P', 'A', 'T'];
            const actual = est.asistencia[data.currentPeriodo][dia] || '';
            const nextIndex = (estados.indexOf(actual) + 1) % estados.length;
            est.asistencia[data.currentPeriodo][dia] = estados[nextIndex];
            
            renderAsistencia();
        }

        function registrarAsistenciaHoy() {
            const hoy = new Date().toISOString().split('T')[0];
            data.currentSeccion.estudiantes.forEach(est => {
                if (!est.asistencia[data.currentPeriodo]) est.asistencia[data.currentPeriodo] = {};
                if (!est.asistencia[data.currentPeriodo][hoy]) {
                    est.asistencia[data.currentPeriodo][hoy] = 'P';
                }
            });
            alert('Asistencia registrada para hoy. Puedes modificarla en la tabla.');
            renderAsistencia();
        }

        // Evaluaciones
        function renderEvaluaciones() {
            const counts = { trabajo: 0, tareas: 0, pruebas: 0 };
            data.currentSeccion.evaluaciones.forEach(ev => counts[ev.tipo]++);
            
            document.getElementById('countTrabajo').textContent = `${counts.trabajo} registros`;
            document.getElementById('countTareas').textContent = `${counts.tareas} registros`;
            document.getElementById('countPruebas').textContent = `${counts.pruebas} registros`;
        }

        function abrirEvaluacion(tipo) {
            data.currentEvalType = tipo;
            const nombres = { trabajo: 'Trabajo Cotidiano', tareas: 'Tareas', pruebas: 'Pruebas' };
            document.getElementById('tituloEvalForm').textContent = `Nueva ${nombres[tipo]}`;
            document.getElementById('formularioEvaluacion').classList.remove('hidden');
            
            const lista = document.getElementById('listaNotasEstudiantes');
            lista.innerHTML = data.currentSeccion.estudiantes.map(est => `
                <div class="flex items-center justify-between bg-white p-3 rounded border">
                    <span class="font-medium ${est.acs ? 'text-orange-600' : ''}">${est.nombre} ${est.acs ? '(ACS)' : ''}</span>
                    <input type="number" min="0" max="100" class="nota-input w-20 px-2 py-1 border rounded text-center" 
                           data-est-id="${est.id}" placeholder="Nota">
                </div>
            `).join('');
        }

        function cancelarEvaluacion() {
            document.getElementById('formularioEvaluacion').classList.add('hidden');
        }

        function guardarEvaluacion() {
            const nombre = document.getElementById('nombreEvaluacion').value;
            const fecha = document.getElementById('fechaEvaluacion').value;
            const porcentaje = document.getElementById('porcentajeEvaluacion').value;
            
            if (!nombre || !fecha) {
                alert('Complete nombre y fecha');
                return;
            }
            
            const notas = [];
            document.querySelectorAll('.nota-input').forEach(input => {
                const val = parseFloat(input.value);
                if (!isNaN(val)) {
                    notas.push({ estId: parseInt(input.dataset.estId), nota: val });
                }
            });
            
            data.currentSeccion.evaluaciones.push({
                id: Date.now(),
                tipo: data.currentEvalType,
                nombre,
                fecha,
                porcentaje: parseFloat(porcentaje) || 0,
                notas
            });
            
            // Update student records
            notas.forEach(n => {
                const est = data.currentSeccion.estudiantes.find(e => e.id === n.estId);
                if (est) {
                    est.notas[data.currentEvalType].push(n.nota);
                }
            });
            
            cancelarEvaluacion();
            renderEvaluaciones();
            alert('Evaluación guardada correctamente');
        }

        function calcularPromedio(est) {
            const pesos = { trabajo: 0.3, tareas: 0.2, pruebas: 0.5 };
            let total = 0, pesoTotal = 0;
            
            for (let tipo in pesos) {
                const notas = est.notas[tipo];
                if (notas.length > 0) {
                    const prom = notas.reduce((a, b) => a + b, 0) / notas.length;
                    total += prom * pesos[tipo];
                    pesoTotal += pesos[tipo];
                }
            }
            
            return pesoTotal > 0 ? (total / pesoTotal) * (pesoTotal > 0 ? 1 : 0) : 0;
        }

        // Reporte Final
        function renderReporteFinal() {
            const tbody = document.getElementById('bodyReporteFinal');
            tbody.innerHTML = data.currentSeccion.estudiantes.map((est, idx) => {
                const prom = calcularPromedio(est);
                const asist = est.asistencia[data.currentPeriodo] || {};
                const totalAsist = Object.values(asist).filter(a => a === 'P').length;
                const total = Object.keys(asist).length;
                const porcAsist = total > 0 ? Math.round((totalAsist/total)*100) : 0;
                
                const promTrabajo = est.notas.trabajo.length ? (est.notas.trabajo.reduce((a,b)=>a+b,0)/est.notas.trabajo.length).toFixed(1) : '-';
                const promTareas = est.notas.tareas.length ? (est.notas.tareas.reduce((a,b)=>a+b,0)/est.notas.tareas.length).toFixed(1) : '-';
                const promPruebas = est.notas.pruebas.length ? (est.notas.pruebas.reduce((a,b)=>a+b,0)/est.notas.pruebas.length).toFixed(1) : '-';
                
                return `
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${idx + 1}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${est.nombre}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-center text-gray-600">${promTrabajo}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-center text-gray-600">${promTareas}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-center text-gray-600">${promPruebas}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-center font-bold ${prom >= 70 ? 'text-green-600' : 'text-red-600'}">${prom.toFixed(1)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-center ${porcAsist >= 80 ? 'text-green-600' : 'text-yellow-600'}">${porcAsist}%</td>
                </tr>
            `}).join('');
        }

        // Horario
        function renderHorario() {
            const horas = ['07:00', '08:00', '09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00'];
            const container = document.getElementById('horarioGrid');
            
            container.innerHTML = horas.map(hora => {
                const clasesHora = data.horario.filter(h => {
                    const inicio = parseInt(h.horaInicio.split(':')[0]);
                    const fin = parseInt(h.horaFin.split(':')[0]);
                    const current = parseInt(hora.split(':')[0]);
                    return current >= inicio && current < fin;
                });
                
                return `
                <div class="grid grid-cols-6 border-b border-gray-100">
                    <div class="p-4 border-r border-gray-200 bg-gray-50 font-medium text-gray-700">${hora}</div>
                    ${[1,2,3,4,5].map(dia => {
                        const clase = data.horario.find(h => {
                            const inicio = parseInt(h.horaInicio.split(':')[0]);
                            const fin = parseInt(h.horaFin.split(':')[0]);
                            const current = parseInt(hora.split(':')[0]);
                            return h.dia === dia && current >= inicio && current < fin;
                        });
                        
                        if (clase && parseInt(clase.horaInicio.split(':')[0]) === parseInt(hora.split(':')[0])) {
                            const duracion = parseInt(clase.horaFin.split(':')[0]) - parseInt(clase.horaInicio.split(':')[0]);
                            return `
                                <div class="p-2 border-r border-gray-200 bg-purple-50 border-l-4 border-purple-500 row-span-${duracion}">
                                    <div class="text-sm font-semibold text-purple-900">${clase.asignatura}</div>
                                    <div class="text-xs text-purple-700">${clase.seccion}</div>
                                    <div class="text-xs text-purple-600">${clase.horaInicio}-${clase.horaFin}</div>
                                </div>
                            `;
                        } else if (clase && parseInt(clase.horaInicio.split(':')[0]) < parseInt(hora.split(':')[0]) && parseInt(hora.split(':')[0]) < parseInt(clase.horaFin.split(':')[0])) {
                            return `<div class="border-r border-gray-200 bg-purple-50"></div>`;
                        } else {
                            return `<div class="p-4 border-r border-gray-200 hover:bg-gray-50 cursor-pointer" onclick="openModal('nuevaClaseModal')"></div>`;
                        }
                    }).join('')}
                </div>
            `}).join('');
        }

        document.getElementById('formNuevaClase').addEventListener('submit', function(e) {
            e.preventDefault();
            const seccion = data.secciones.find(s => s.id === parseInt(document.getElementById('claseSeccion').value));
            const nuevaClase = {
                id: Date.now(),
                seccionId: seccion.id,
                dia: parseInt(document.getElementById('claseDia').value),
                horaInicio: document.getElementById('claseHoraInicio').value,
                horaFin: document.getElementById('claseHoraFin').value,
                asignatura: seccion.asignatura,
                seccion: seccion.seccion
            };
            data.horario.push(nuevaClase);
            closeModal('nuevaClaseModal');
            this.reset();
            renderHorario();
        });

        // Bitácoras
        function renderBitacoras() {
            const container = document.getElementById('listaBitacoras');
            if (data.bitacoras.length === 0) {
                container.innerHTML = '<div class="text-center py-12 text-gray-500 bg-white rounded-xl">No hay bitácoras registradas</div>';
                return;
            }
            
            container.innerHTML = data.bitacoras.map(b => `
                <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-semibold text-lg text-gray-900">${b.titulo}</h4>
                        <span class="text-sm text-gray-500">${new Date(b.fecha).toLocaleDateString()}</span>
                    </div>
                    <p class="text-sm text-purple-600 mb-3">${b.seccionNombre}</p>
                    <p class="text-gray-700 mb-3">${b.contenido}</p>
                    ${b.recordatorio ? '<span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-orange-100 text-orange-800"><i class="fas fa-bell mr-1"></i> Recordatorio activo</span>' : ''}
                </div>
            `).join('');
            
            document.getElementById('bitacoraCount').textContent = data.bitacoras.filter(b => b.recordatorio).length;
        }

        document.getElementById('formBitacora').addEventListener('submit', function(e) {
            e.preventDefault();
            const seccion = data.secciones.find(s => s.id === parseInt(document.getElementById('bitacoraSeccion').value));
            const nueva = {
                id: Date.now(),
                titulo: document.getElementById('bitacoraTitulo').value,
                seccionId: seccion.id,
                seccionNombre: `${seccion.asignatura} - ${seccion.seccion}`,
                contenido: document.getElementById('bitacoraContenido').value,
                fecha: new Date().toISOString(),
                recordatorio: document.getElementById('bitacoraRecordatorio').checked
            };
            data.bitacoras.unshift(nueva);
            closeModal('nuevaBitacoraModal');
            this.reset();
            renderBitacoras();
        });

        // Reportes y Exportación
        function updateSelects() {
            const opts = data.secciones.map(s => `<option value="${s.id}">${s.asignatura} - ${s.seccion}</option>`).join('');
            document.getElementById('bitacoraSeccion').innerHTML = opts;
            document.getElementById('claseSeccion').innerHTML = opts;
        }

        function updateReportesSelects() {
            const estudiantesOpts = data.secciones.flatMap(s => 
                s.estudiantes.map(e => `<option value="${e.id}" data-seccion="${s.id}">${e.nombre} (${s.asignatura})</option>`)
            ).join('');
            document.getElementById('selectReporteEstudiante').innerHTML = '<option value="">Seleccionar estudiante...</option>' + estudiantesOpts;
            
            const seccionOpts = data.secciones.map(s => `<option value="${s.id}">${s.asignatura} - ${s.seccion}</option>`).join('');
            document.getElementById('selectReporteSeccion').innerHTML = '<option value="">Seleccionar sección...</option>' + seccionOpts;
        }

        function generarReportePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(18);
            doc.text(`Reporte Final - ${data.currentSeccion.asignatura}`, 14, 20);
            doc.setFontSize(12);
            doc.text(`Sección: ${data.currentSeccion.seccion} | Periodo: ${data.currentPeriodo}`, 14, 30);
            
            const rows = data.currentSeccion.estudiantes.map((est, idx) => {
                const prom = calcularPromedio(est);
                return [idx + 1, est.nombre, prom.toFixed(1), prom >= 70 ? 'Aprobado' : 'Reprobado'];
            });
            
            doc.autoTable({
                head: [['#', 'Estudiante', 'Promedio', 'Estado']],
                body: rows,
                startY: 40
            });
            
            doc.save(`Reporte_${data.currentSeccion.asignatura}_${data.currentPeriodo}.pdf`);
        }

        function generarReporteIndividualPDF() {
            const select = document.getElementById('selectReporteEstudiante');
            const estId = parseInt(select.value);
            if (!estId) return alert('Seleccione un estudiante');
            
            const seccion = data.secciones.find(s => s.estudiantes.some(e => e.id === estId));
            const est = seccion.estudiantes.find(e => e.id === estId);
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(18);
            doc.text('Reporte Individual del Estudiante', 14, 20);
            doc.setFontSize(12);
            doc.text(`Estudiante: ${est.nombre}`, 14, 35);
            doc.text(`Sección: ${seccion.asignatura} - ${seccion.seccion}`, 14, 45);
            doc.text(`Periodo: ${data.currentPeriodo}`, 14, 55);
            
            const prom = calcularPromedio(est);
            const asist = est.asistencia[data.currentPeriodo] || {};
            const totalAsist = Object.values(asist).filter(a => a === 'P').length;
            const total = Object.keys(asist).length;
            const porcAsist = total > 0 ? Math.round((totalAsist/total)*100) : 0;
            
            doc.text(`Promedio Académico: ${prom.toFixed(1)}`, 14, 70);
            doc.text(`Asistencia: ${porcAsist}%`, 14, 80);
            
            doc.save(`Reporte_${est.nombre}.pdf`);
        }

        function exportarExcel() {
            const seccionId = document.getElementById('selectReporteSeccion').value;
            if (!seccionId) return alert('Seleccione una sección');
            
            const seccion = data.secciones.find(s => s.id === parseInt(seccionId));
            let csv = 'Nombre,Trabajo Cotidiano,Tareas,Pruebas,Promedio,Asistencia\n';
            
            seccion.estudiantes.forEach(est => {
                const prom = calcularPromedio(est);
                const promT = est.notas.trabajo.length ? (est.notas.trabajo.reduce((a,b)=>a+b,0)/est.notas.trabajo.length).toFixed(1) : '0';
                const promTa = est.notas.tareas.length ? (est.notas.tareas.reduce((a,b)=>a+b,0)/est.notas.tareas.length).toFixed(1) : '0';
                const promP = est.notas.pruebas.length ? (est.notas.pruebas.reduce((a,b)=>a+b,0)/est.notas.pruebas.length).toFixed(1) : '0';
                
                csv += `"${est.nombre}",${promT},${promTa},${promP},${prom.toFixed(1)},${prom >= 70 ? 'Aprobado' : 'Reprobado'}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Notas_${seccion.asignatura}.csv`;
            a.click();
        }

        function generarCSV() {
            exportarExcel(); // Same format for demo
        }

        function irAAsistencia(seccionId) {
            verDetalleSeccion(seccionId);
            cambiarTab('asistencia');
        }

        // Close modals on outside click
        window.onclick = function(event) {
            if (event.target.classList.contains('fixed')) {
                event.target.classList.add('hidden');
            }
        }
    </script>
</body>
</html>
