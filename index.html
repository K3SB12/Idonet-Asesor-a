<!DOCTYPE html>
<html lang="es-CR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Integral de Gesti√≥n Docente ¬∑ MEP Costa Rica</title>
    <style>
        /* ============================================
           ESTILOS INSTITUCIONALES MEP - VERSI√ìN ACCESIBLE
           Basado en Reglamento de Evaluaci√≥n y Gu√≠as MEP
           Relaci√≥n de contraste WCAG AA m√≠nima 4.5:1
        ============================================ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, system-ui, -apple-system, sans-serif;
        }

        :root {
            /* Paleta institucional MEP - Versi√≥n Accesible */
            --color-primario: #0B3B2F;      /* Verde MEP oscuro (texto principal/botones) */
            --color-secundario: #E7F0EB;     /* Fondo claro institucional */
            --color-acento: #A7C1B0;          /* Verde claro para acentos y bordes */
            --color-texto: #1A2A24;           /* Casi negro, excelente contraste sobre fondos claros */
            --color-texto-sobre-oscuro: #FFFFFF; /* Blanco puro */
            --color-fondo: #F4F7F5;           /* Fondo general claro */
            --color-tarjeta: #FFFFFF;          /* Fondo de tarjetas */
            --color-borde: #B7C9BD;            /* Borde con contraste suficiente */
            --color-alerta: #D32F2F;           /* Rojo para errores (contraste verificado) */
            --color-exito: #2E7D32;            /* Verde √©xito (contraste verificado) */
            --color-advertencia: #B85C1A;      /* Naranja/advertencia m√°s oscuro para contraste */
            --color-enlace: #0B5E7E;            /* Azul para enlaces */
            --sombra-suave: rgba(0, 0, 0, 0.08);
        }

        body {
            display: flex;
            min-height: 100vh;
            background-color: var(--color-fondo);
            color: var(--color-texto);
            line-height: 1.5;
        }

        /* --- BARRA LATERAL FIJA Y ACCESIBLE --- */
        .sidebar {
            width: 280px;
            background-color: var(--color-primario);
            color: var(--color-texto-sobre-oscuro);
            padding: 2rem 1rem;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            box-shadow: 4px 0 15px rgba(0, 0, 0, 0.15);
        }

        .sidebar-header {
            padding-bottom: 1.5rem;
            border-bottom: 2px solid var(--color-acento);
            margin-bottom: 1.5rem;
        }

        .sidebar-header h1 {
            font-size: 1.3rem;
            font-weight: 600;
            line-height: 1.4;
            color: var(--color-texto-sobre-oscuro);
        }

        .sidebar-header small {
            font-size: 0.8rem;
            color: var(--color-acento);
            display: block;
            margin-top: 0.5rem;
        }

        .nav-btn {
            width: 100%;
            background: transparent;
            border: none;
            color: var(--color-texto-sobre-oscuro);
            padding: 1rem 1.2rem;
            text-align: left;
            font-size: 1rem;
            border-radius: 12px 0 0 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 0.25rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            border-left: 4px solid transparent;
        }

        .nav-btn:hover {
            background-color: rgba(255, 255, 255, 0.15);
            outline: 2px solid var(--color-acento);
            outline-offset: -2px;
        }

        .nav-btn:focus-visible {
            outline: 3px solid var(--color-acento);
            outline-offset: 2px;
        }

        .nav-btn.active {
            background-color: var(--color-fondo);
            color: var(--color-primario);
            border-left: 4px solid var(--color-acento);
            font-weight: 600;
        }

        /* --- CONTENIDO PRINCIPAL --- */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 2rem;
            min-height: 100vh;
        }

        /* --- PESTA√ëAS --- */
        .pestana {
            display: none;
        }

        .pestana.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0.6; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- TARJETAS Y COMPONENTES DE INTERFAZ --- */
        .card {
            background-color: var(--color-tarjeta);
            border-radius: 24px;
            padding: 2rem;
            box-shadow: 0 8px 24px var(--sombra-suave);
            border: 1px solid var(--color-borde);
            margin-bottom: 2rem;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--color-acento);
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--color-primario);
        }

        .grid-2, .grid-3, .grid-4 {
            display: grid;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .grid-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-3 { grid-template-columns: repeat(3, 1fr); }
        .grid-4 { grid-template-columns: repeat(4, 1fr); }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group label {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--color-primario);
        }

        input, select, textarea, .btn {
            font-size: 1rem;
            padding: 0.8rem 1.2rem;
            border-radius: 14px;
            border: 2px solid transparent;
        }

        input, select, textarea {
            background-color: var(--color-fondo);
            border: 2px solid var(--color-borde);
            color: var(--color-texto);
            width: 100%;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--color-primario);
            box-shadow: 0 0 0 3px rgba(11, 59, 47, 0.25);
        }

        .btn {
            background-color: var(--color-primario);
            color: var(--color-texto-sobre-oscuro);
            font-weight: 600;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

        .btn:hover {
            background-color: #0F4F3F;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }

        .btn:focus-visible {
            outline: 3px solid var(--color-acento);
            outline-offset: 2px;
        }

        .btn-secondary {
            background-color: var(--color-acento);
            color: var(--color-primario);
        }

        .btn-secondary:hover {
            background-color: #8FAF9A;
        }

        /* --- TABLAS ACCESIBLES --- */
        .table-responsive {
            overflow-x: auto;
            border-radius: 16px;
            border: 1px solid var(--color-borde);
            margin: 1.5rem 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background-color: var(--color-tarjeta);
        }

        th {
            background-color: var(--color-primario);
            color: var(--color-texto-sobre-oscuro);
            font-weight: 600;
            padding: 1rem;
            text-align: left;
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid var(--color-borde);
        }

        /* --- BADGES Y MENSAJES DE ESTADO --- */
        .badge {
            display: inline-block;
            padding: 0.25rem 1rem;
            border-radius: 40px;
            font-size: 0.85rem;
            font-weight: 600;
            text-align: center;
        }

        .badge-success {
            background-color: var(--color-exito);
            color: var(--color-texto-sobre-oscuro);
        }

        .badge-warning {
            background-color: var(--color-advertencia);
            color: var(--color-texto-sobre-oscuro);
        }

        .badge-error {
            background-color: var(--color-alerta);
            color: var(--color-texto-sobre-oscuro);
        }

        .alert {
            padding: 1rem 1.5rem;
            border-radius: 16px;
            margin-bottom: 1.5rem;
            border-left: 6px solid;
            background-color: var(--color-tarjeta);
        }

        .alert-warning {
            border-left-color: var(--color-advertencia);
            background-color: #FEF6E6;
        }

        .alert-success {
            border-left-color: var(--color-exito);
            background-color: #E1F3E6;
        }

        /* --- HERRAMIENTAS DE ACCESIBILIDAD ADICIONALES --- */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }

        [role="tooltip"] {
            position: relative;
        }

        [role="tooltip"]:hover::after,
        [role="tooltip"]:focus::after {
            content: attr(aria-label);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--color-primario);
            color: var(--color-texto-sobre-oscuro);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.85rem;
            white-space: nowrap;
            z-index: 10;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        /* --- RESPONSIVE --- */
        @media (max-width: 1024px) {
            .grid-4 { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 768px) {
            body { flex-direction: column; }
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                padding: 1rem;
            }
            .main-content {
                margin-left: 0;
                padding: 1.5rem;
            }
            .grid-2, .grid-3, .grid-4 {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- BARRA LATERAL DE NAVEGACI√ìN (ACCESIBLE) -->
    <aside class="sidebar" aria-label="Navegaci√≥n principal del sistema">
        <div class="sidebar-header">
            <h1>Gesti√≥n Docente MEP</h1>
            <small>Consejo Superior de Educaci√≥n ¬∑ Costa Rica</small>
        </div>
        <nav aria-label="M√≥dulos del sistema">
            <button class="nav-btn active" data-pestana="config" aria-current="page">‚öôÔ∏è Configuraci√≥n</button>
            <button class="nav-btn" data-pestana="estudiantes">üë• Estudiantes</button>
            <button class="nav-btn" data-pestana="asistencia">üìÜ Asistencia</button>
            <button class="nav-btn" data-pestana="componentes">üìä Evaluaci√≥n</button>
            <button class="nav-btn" data-pestana="acta">üìú Acta Final</button>
            <button class="nav-btn" data-pestana="reportes">üìà Reportes</button>
            <button class="nav-btn" data-pestana="bitacora">üìì Bit√°cora DUA</button>
            <button class="nav-btn" data-pestana="instrumentos">üìã Instrumentos</button>
            <button class="nav-btn" data-pestana="respaldo">üíæ Respaldo</button>
        </nav>
    </aside>

    <!-- CONTENIDO PRINCIPAL -->
    <main class="main-content" id="contenido-principal">
        <!-- Las pesta√±as se cargar√°n din√°micamente aqu√≠ -->
    </main>

    <script>
        (function() {
            "use strict";

            // =========================================================================
            // MODELO DE DATOS CENTRAL Y PERSISTENCIA (localStorage)
            // =========================================================================
            const ModeloMEP = {
                centros: JSON.parse(localStorage.getItem('mep_centros')) || [{
                    id: 'inst1', nombre: 'Liceo Experimental MEP', nivel: 'secundaria'
                }],
                estudiantes: JSON.parse(localStorage.getItem('mep_estudiantes')) || [
                    { id: 'e1', centroId: 'inst1', nombre: 'Alberto Laureano Guevara', seccion: '9-1', telefono1: '8888-1111', telefono2: '8888-1112', correoEncargado: 'padre@ejemplo.com', acs: false },
                    { id: 'e2', centroId: 'inst1', nombre: 'Mar√≠a Jos√© Jim√©nez', seccion: '9-1', telefono1: '8888-2222', telefono2: '8888-2223', correoEncargado: 'madre@ejemplo.com', acs: true }
                ],
                configuraciones: JSON.parse(localStorage.getItem('mep_config')) || {
                    centroId: 'inst1', tc: 40, pry: 30, pba: 20, tar: 10
                },
                calificaciones: JSON.parse(localStorage.getItem('mep_calificaciones')) || [],
                asistencia: JSON.parse(localStorage.getItem('mep_asistencia')) || [],
                periodos: JSON.parse(localStorage.getItem('mep_periodos')) || [
                    { id: 'p1', centroId: 'inst1', nombre: 'I Periodo', estado: 'abierto', a√±o: 2025 },
                    { id: 'p2', centroId: 'inst1', nombre: 'II Periodo', estado: 'pendiente', a√±o: 2025 },
                    { id: 'p3', centroId: 'inst1', nombre: 'III Periodo', estado: 'pendiente', a√±o: 2025 }
                ]
            };

            function guardarTodo() {
                localStorage.setItem('mep_centros', JSON.stringify(ModeloMEP.centros));
                localStorage.setItem('mep_estudiantes', JSON.stringify(ModeloMEP.estudiantes));
                localStorage.setItem('mep_config', JSON.stringify(ModeloMEP.configuraciones));
                localStorage.setItem('mep_calificaciones', JSON.stringify(ModeloMEP.calificaciones));
                localStorage.setItem('mep_asistencia', JSON.stringify(ModeloMEP.asistencia));
                localStorage.setItem('mep_periodos', JSON.stringify(ModeloMEP.periodos));
            }

            // =========================================================================
            // MOTOR DE C√ÅLCULO (VALIDACIONES MEP)
            // =========================================================================
            const MotorCalculo = {
                validarPorcentajes(tc, pry, pba, tar) {
                    const suma = (tc || 0) + (pry || 0) + (pba || 0) + (tar || 0);
                    return suma === 100;
                },
                calcularPromedioEstandar(notas, porcentajes) {
                    const { trabajoCotidiano, proyecto, prueba, tareas } = notas;
                    const { tc, pry, pba, tar } = porcentajes;
                    if ([trabajoCotidiano, proyecto, prueba, tareas].some(n => n === null || n === undefined || n === '')) {
                        throw new Error("Notas incompletas");
                    }
                    return (
                        (parseFloat(trabajoCotidiano) * (tc / 100)) +
                        (parseFloat(proyecto) * (pry / 100)) +
                        (parseFloat(prueba) * (pba / 100)) +
                        (parseFloat(tareas) * (tar / 100))
                    ).toFixed(2);
                },
                determinarEstadoFinal(promedio) {
                    const p = parseFloat(promedio);
                    if (p >= 65) return "APROBADO";
                    if (p >= 50) return "CONVOCATORIA";
                    return "REPROBADO";
                }
            };

            // =========================================================================
            // VALIDADOR DE REGLAS MEP
            // =========================================================================
            const ValidadorMEP = {
                email: (email) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email),
                periodoCompleto(grupoId, periodo) {
                    const estudiantesGrupo = ModeloMEP.estudiantes.filter(e => e.seccion === grupoId);
                    const calificacionesPeriodo = ModeloMEP.calificaciones.filter(c => c.periodo === periodo);
                    for (let est of estudiantesGrupo) {
                        if (!calificacionesPeriodo.some(c => c.estudianteId === est.id)) return false;
                    }
                    return true;
                }
            };

            // =========================================================================
            // CONTROLADOR DE UI Y RENDERIZADO
            // =========================================================================
            const UI = {
                pestanaActiva: 'config',
                init() {
                    this.configurarNavegacion();
                    this.cambiarPestana('config');
                },
                configurarNavegacion() {
                    document.querySelectorAll('.nav-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const pestana = e.currentTarget.dataset.pestana;
                            this.cambiarPestana(pestana);
                            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                            e.currentTarget.classList.add('active');
                        });
                    });
                },
                cambiarPestana(pestanaId) {
                    this.pestanaActiva = pestanaId;
                    const container = document.getElementById('contenido-principal');
                    switch(pestanaId) {
                        case 'config': this.renderConfiguracion(container); break;
                        case 'estudiantes': this.renderEstudiantes(container); break;
                        case 'asistencia': this.renderAsistencia(container); break;
                        case 'componentes': this.renderComponentes(container); break;
                        case 'acta': this.renderActaFinal(container); break;
                        case 'reportes': this.renderReportes(container); break;
                        case 'bitacora': this.renderBitacora(container); break;
                        case 'instrumentos': this.renderInstrumentos(container); break;
                        case 'respaldo': this.renderRespaldo(container); break;
                        default: this.renderConfiguracion(container);
                    }
                },
                // --------------------------------------------------------------
                // 1. CONFIGURACI√ìN GENERAL
                // --------------------------------------------------------------
                renderConfiguracion(container) {
                    const config = ModeloMEP.configuraciones;
                    container.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">‚öôÔ∏è Configuraci√≥n Institucional MEP</h2>
                            </div>
                            <div class="grid-2">
                                <div class="form-group">
                                    <label for="config-centro">Centro Educativo</label>
                                    <select id="config-centro" aria-describedby="centro-help">
                                        ${ModeloMEP.centros.map(c => `<option value="${c.id}" ${c.id === config.centroId ? 'selected' : ''}>${c.nombre}</option>`).join('')}
                                    </select>
                                    <span id="centro-help" class="sr-only">Seleccione el centro educativo activo</span>
                                </div>
                                <div class="form-group">
                                    <label for="config-nivel">Nivel</label>
                                    <select id="config-nivel">
                                        <option value="primaria">Primaria</option>
                                        <option value="secundaria" selected>Secundaria</option>
                                    </select>
                                </div>
                            </div>
                            <div class="grid-4">
                                <div class="form-group">
                                    <label for="config-tc">Trabajo Cotidiano (%)</label>
                                    <input type="number" id="config-tc" value="${config.tc}" min="0" max="100" step="1">
                                </div>
                                <div class="form-group">
                                    <label for="config-pry">Proyecto (%)</label>
                                    <input type="number" id="config-pry" value="${config.pry}" min="0" max="100" step="1">
                                </div>
                                <div class="form-group">
                                    <label for="config-pba">Prueba (%)</label>
                                    <input type="number" id="config-pba" value="${config.pba}" min="0" max="100" step="1">
                                </div>
                                <div class="form-group">
                                    <label for="config-tar">Tareas (%)</label>
                                    <input type="number" id="config-tar" value="${config.tar}" min="0" max="100" step="1">
                                </div>
                            </div>
                            <div class="toolbar">
                                <span id="suma-porcentajes" class="badge badge-success">Suma: 100% ‚úÖ</span>
                                <button class="btn" id="guardar-config" aria-label="Guardar configuraci√≥n actual">üíæ Guardar</button>
                                <button class="btn btn-secondary" id="reset-config" aria-label="Restablecer valores por defecto">üîÑ Restablecer</button>
                            </div>
                        </div>
                    `;
                    document.getElementById('guardar-config')?.addEventListener('click', this.guardarConfiguracion.bind(this));
                    document.getElementById('reset-config')?.addEventListener('click', () => {
                        if(confirm('¬øRestablecer la configuraci√≥n a los valores por defecto?')) {
                            ModeloMEP.configuraciones = { centroId: 'inst1', tc: 40, pry: 30, pba: 20, tar: 10 };
                            guardarTodo();
                            this.cambiarPestana('config');
                        }
                    });
                },
                guardarConfiguracion() {
                    const tc = parseInt(document.getElementById('config-tc').value);
                    const pry = parseInt(document.getElementById('config-pry').value);
                    const pba = parseInt(document.getElementById('config-pba').value);
                    const tar = parseInt(document.getElementById('config-tar').value);
                    if (!MotorCalculo.validarPorcentajes(tc, pry, pba, tar)) {
                        alert('Error: Los porcentajes deben sumar exactamente 100%');
                        return;
                    }
                    ModeloMEP.configuraciones = {
                        centroId: document.getElementById('config-centro').value,
                        tc, pry, pba, tar
                    };
                    guardarTodo();
                    alert('‚úÖ Configuraci√≥n guardada exitosamente');
                },
                // --------------------------------------------------------------
                // 2. ESTUDIANTES (CRUD Completo)
                // --------------------------------------------------------------
                renderEstudiantes(container) {
                    const estudiantes = ModeloMEP.estudiantes;
                    container.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">üë• Gesti√≥n de Estudiantes</h2>
                            </div>
                            <div class="grid-2">
                                <div class="form-group">
                                    <label for="est-nombre">Nombre completo</label>
                                    <input type="text" id="est-nombre" placeholder="Ej: P√©rez, Juan Carlos">
                                </div>
                                <div class="form-group">
                                    <label for="est-seccion">Secci√≥n</label>
                                    <input type="text" id="est-seccion" placeholder="Ej: 9-1">
                                </div>
                                <div class="form-group">
                                    <label for="est-tel1">Tel√©fono 1 (principal)</label>
                                    <input type="tel" id="est-tel1" placeholder="8888-1111">
                                </div>
                                <div class="form-group">
                                    <label for="est-tel2">Tel√©fono 2</label>
                                    <input type="tel" id="est-tel2" placeholder="8888-1112">
                                </div>
                                <div class="form-group">
                                    <label for="est-correo">Correo del encargado</label>
                                    <input type="email" id="est-correo" placeholder="encargado@ejemplo.com">
                                </div>
                                <div class="form-group">
                                    <label><input type="checkbox" id="est-acs"> ¬øEstudiante con ACS?</label>
                                </div>
                            </div>
                            <button class="btn" id="agregar-estudiante">‚ûï Agregar Estudiante</button>
                        </div>
                        <div class="card">
                            <h3>Lista de Estudiantes</h3>
                            <div class="table-responsive">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Nombre</th>
                                            <th>Secci√≥n</th>
                                            <th>Tel√©fono 1</th>
                                            <th>Tel√©fono 2</th>
                                            <th>Correo Encargado</th>
                                            <th>ACS</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tabla-estudiantes-body"></tbody>
                                </table>
                            </div>
                        </div>
                    `;
                    this.actualizarTablaEstudiantes();
                    document.getElementById('agregar-estudiante')?.addEventListener('click', this.agregarEstudiante.bind(this));
                },
                actualizarTablaEstudiantes() {
                    const tbody = document.getElementById('tabla-estudiantes-body');
                    if (!tbody) return;
                    tbody.innerHTML = ModeloMEP.estudiantes.map(e => `
                        <tr>
                            <td>${e.nombre}</td>
                            <td>${e.seccion}</td>
                            <td>${e.telefono1}</td>
                            <td>${e.telefono2}</td>
                            <td>${e.correoEncargado}</td>
                            <td>${e.acs ? '‚úÖ' : '‚ùå'}</td>
                            <td>
                                <button class="btn btn-secondary btn-small" onclick="UI.eliminarEstudiante('${e.id}')">üóëÔ∏è</button>
                            </td>
                        </tr>
                    `).join('');
                },
                agregarEstudiante() {
                    const nuevo = {
                        id: 'e' + Date.now(),
                        centroId: ModeloMEP.configuraciones.centroId,
                        nombre: document.getElementById('est-nombre').value,
                        seccion: document.getElementById('est-seccion').value,
                        telefono1: document.getElementById('est-tel1').value,
                        telefono2: document.getElementById('est-tel2').value,
                        correoEncargado: document.getElementById('est-correo').value,
                        acs: document.getElementById('est-acs').checked
                    };
                    if (!nuevo.nombre || !nuevo.seccion) {
                        alert('‚ùå Nombre y secci√≥n son obligatorios');
                        return;
                    }
                    ModeloMEP.estudiantes.push(nuevo);
                    guardarTodo();
                    this.actualizarTablaEstudiantes();
                },
                eliminarEstudiante(id) {
                    if (confirm('¬øEliminar este estudiante?')) {
                        ModeloMEP.estudiantes = ModeloMEP.estudiantes.filter(e => e.id !== id);
                        guardarTodo();
                        this.actualizarTablaEstudiantes();
                    }
                },
                // --------------------------------------------------------------
                // 3. ASISTENCIA (Simplificada pero funcional)
                // --------------------------------------------------------------
                renderAsistencia(container) {
                    container.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">üìÜ Control de Asistencia</h2>
                            </div>
                            <div class="grid-2">
                                <div class="form-group">
                                    <label for="asis-fecha">Fecha</label>
                                    <input type="date" id="asis-fecha" value="${new Date().toISOString().split('T')[0]}">
                                </div>
                                <div class="form-group">
                                    <label for="asis-seccion">Secci√≥n</label>
                                    <input type="text" id="asis-seccion" placeholder="Ej: 9-1">
                                </div>
                            </div>
                            <button class="btn" id="cargar-asistencia">üìÖ Cargar Lista</button>
                            <div id="asistencia-tabla" class="table-responsive mt-3"></div>
                            <button class="btn btn-secondary mt-3" id="guardar-asistencia">üíæ Guardar Asistencia</button>
                        </div>
                    `;
                    document.getElementById('cargar-asistencia')?.addEventListener('click', this.cargarListaAsistencia.bind(this));
                },
                cargarListaAsistencia() {
                    const seccion = document.getElementById('asis-seccion').value;
                    const fecha = document.getElementById('asis-fecha').value;
                    const estudiantes = ModeloMEP.estudiantes.filter(e => e.seccion === seccion);
                    if (estudiantes.length === 0) {
                        alert('No hay estudiantes en esa secci√≥n');
                        return;
                    }
                    let html = '<table><tr><th>Estudiante</th><th>Estado</th></tr>';
                    estudiantes.forEach(e => {
                        const registro = ModeloMEP.asistencia.find(a => a.fecha === fecha && a.estudianteId === e.id);
                        const estado = registro ? registro.estado : 'P';
                        html += `<tr>
                            <td>${e.nombre}</td>
                            <td>
                                <select data-estudiante="${e.id}" data-fecha="${fecha}" class="estado-asistencia">
                                    <option value="P" ${estado === 'P' ? 'selected' : ''}>Presente</option>
                                    <option value="A" ${estado === 'A' ? 'selected' : ''}>Ausente</option>
                                    <option value="J" ${estado === 'J' ? 'selected' : ''}>Justificada</option>
                                    <option value="T" ${estado === 'T' ? 'selected' : ''}>Tard√≠a</option>
                                </select>
                            </td>
                        </tr>`;
                    });
                    html += '</table>';
                    document.getElementById('asistencia-tabla').innerHTML = html;
                    document.getElementById('guardar-asistencia').addEventListener('click', () => {
                        document.querySelectorAll('.estado-asistencia').forEach(sel => {
                            ModeloMEP.asistencia = ModeloMEP.asistencia.filter(a => !(a.fecha === fecha && a.estudianteId === sel.dataset.estudiante));
                            ModeloMEP.asistencia.push({
                                id: 'a' + Date.now() + sel.dataset.estudiante,
                                estudianteId: sel.dataset.estudiante,
                                fecha,
                                estado: sel.value
                            });
                        });
                        guardarTodo();
                        alert('‚úÖ Asistencia guardada');
                    }, { once: true });
                },
                // --------------------------------------------------------------
                // 4. COMPONENTES DE EVALUACI√ìN (Motor de c√°lculo)
                // --------------------------------------------------------------
                renderComponentes(container) {
                    const estudiantes = ModeloMEP.estudiantes;
                    const config = ModeloMEP.configuraciones;
                    let htmlTabla = `
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">üìä Registro de Componentes</h2>
                            </div>
                            <div class="table-responsive">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Estudiante</th>
                                            <th>ACS</th>
                                            <th>Trabajo Cot.</th>
                                            <th>Proyecto</th>
                                            <th>Prueba</th>
                                            <th>Tareas</th>
                                            <th>Promedio</th>
                                            <th>Estado</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                    `;
                    estudiantes.forEach(e => {
                        const cal = ModeloMEP.calificaciones.find(c => c.estudianteId === e.id && c.periodo === 'I') || { trabajoCotidiano: '', proyecto: '', prueba: '', tareas: '' };
                        htmlTabla += `
                            <tr>
                                <td>${e.nombre}</td>
                                <td>${e.acs ? 'ACS' : '-'}</td>
                                <td><input type="number" class="nota" data-id="${e.id}" data-tipo="tc" value="${cal.trabajoCotidiano || ''}" min="0" max="100" step="0.1"></td>
                                <td><input type="number" class="nota" data-id="${e.id}" data-tipo="pry" value="${cal.proyecto || ''}" min="0" max="100" step="0.1"></td>
                                <td><input type="number" class="nota" data-id="${e.id}" data-tipo="pba" value="${cal.prueba || ''}" min="0" max="100" step="0.1"></td>
                                <td><input type="number" class="nota" data-id="${e.id}" data-tipo="tar" value="${cal.tareas || ''}" min="0" max="100" step="0.1"></td>
                                <td class="promedio-${e.id}">-</td>
                                <td class="estado-${e.id}">-</td>
                            </tr>
                        `;
                    });
                    htmlTabla += `
                                    </tbody>
                                </table>
                            </div>
                            <button class="btn" id="calcular-todo">üßÆ Calcular Promedios</button>
                            <button class="btn btn-secondary" id="guardar-componentes">üíæ Guardar Calificaciones</button>
                        </div>
                    `;
                    container.innerHTML = htmlTabla;

                    document.getElementById('calcular-todo')?.addEventListener('click', () => {
                        const config = ModeloMEP.configuraciones;
                        document.querySelectorAll('.nota').forEach(input => {
                            const id = input.dataset.id;
                            const tc = parseFloat(document.querySelector(`[data-id="${id}"][data-tipo="tc"]`).value) || 0;
                            const pry = parseFloat(document.querySelector(`[data-id="${id}"][data-tipo="pry"]`).value) || 0;
                            const pba = parseFloat(document.querySelector(`[data-id="${id}"][data-tipo="pba"]`).value) || 0;
                            const tar = parseFloat(document.querySelector(`[data-id="${id}"][data-tipo="tar"]`).value) || 0;
                            if (tc && pry && pba && tar) {
                                try {
                                    const prom = MotorCalculo.calcularPromedioEstandar(
                                        { trabajoCotidiano: tc, proyecto: pry, prueba: pba, tareas: tar },
                                        config
                                    );
                                    document.querySelector(`.promedio-${id}`).textContent = prom;
                                    document.querySelector(`.estado-${id}`).textContent = MotorCalculo.determinarEstadoFinal(prom);
                                } catch (e) { /* ignorar */ }
                            }
                        });
                    });

                    document.getElementById('guardar-componentes')?.addEventListener('click', () => {
                        ModeloMEP.calificaciones = [];
                        document.querySelectorAll('.nota').forEach(input => {
                            const id = input.dataset.id;
                            const tc = parseFloat(document.querySelector(`[data-id="${id}"][data-tipo="tc"]`).value) || null;
                            const pry = parseFloat(document.querySelector(`[data-id="${id}"][data-tipo="pry"]`).value) || null;
                            const pba = parseFloat(document.querySelector(`[data-id="${id}"][data-tipo="pba"]`).value) || null;
                            const tar = parseFloat(document.querySelector(`[data-id="${id}"][data-tipo="tar"]`).value) || null;
                            if (tc && pry && pba && tar) {
                                ModeloMEP.calificaciones.push({
                                    id: 'c' + Date.now() + id,
                                    estudianteId: id,
                                    periodo: 'I',
                                    trabajoCotidiano: tc,
                                    proyecto: pry,
                                    prueba: pba,
                                    tareas: tar
                                });
                            }
                        });
                        guardarTodo();
                        alert('‚úÖ Calificaciones guardadas');
                    });
                },
                // --------------------------------------------------------------
                // 5. ACTA FINAL (Validaci√≥n de periodos)
                // --------------------------------------------------------------
                renderActaFinal(container) {
                    const estudiantes = ModeloMEP.estudiantes;
                    let html = `
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">üìú Acta Final de Evaluaci√≥n</h2>
                            </div>
                            <div class="table-responsive">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Estudiante</th>
                                            <th>I Periodo</th>
                                            <th>II Periodo</th>
                                            <th>III Periodo</th>
                                            <th>Promedio Anual</th>
                                            <th>Condici√≥n Final</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                    `;
                    estudiantes.forEach(e => {
                        const notas = ModeloMEP.calificaciones.filter(c => c.estudianteId === e.id);
                        const nota1 = notas.find(n => n.periodo === 'I')?.trabajoCotidiano || '-';
                        const nota2 = notas.find(n => n.periodo === 'II')?.trabajoCotidiano || '-';
                        const nota3 = notas.find(n => n.periodo === 'III')?.trabajoCotidiano || '-';
                        let promedioAnual = '-';
                        if (nota1 !== '-' && nota2 !== '-' && nota3 !== '-') {
                            const prom = (parseFloat(nota1) + parseFloat(nota2) + parseFloat(nota3)) / 3;
                            promedioAnual = prom.toFixed(2);
                        }
                        html += `
                            <tr>
                                <td>${e.nombre}</td>
                                <td>${nota1}</td>
                                <td>${nota2}</td>
                                <td>${nota3}</td>
                                <td><strong>${promedioAnual}</strong></td>
                                <td>${promedioAnual !== '-' ? MotorCalculo.determinarEstadoFinal(promedioAnual) : 'Pendiente'}</td>
                            </tr>
                        `;
                    });
                    html += `
                                    </tbody>
                                </table>
                            </div>
                            <button class="btn" id="validar-acta">üîç Validar Periodos Completos</button>
                        </div>
                    `;
                    container.innerHTML = html;
                    document.getElementById('validar-acta')?.addEventListener('click', () => {
                        const completa = ValidadorMEP.periodoCompleto('9-1', 'I') && ValidadorMEP.periodoCompleto('9-1', 'II') && ValidadorMEP.periodoCompleto('9-1', 'III');
                        alert(completa ? '‚úÖ Todos los periodos est√°n completos' : '‚ö†Ô∏è Faltan calificaciones en uno o m√°s periodos');
                    });
                },
                // --------------------------------------------------------------
                // 6. REPORTES (Exportaci√≥n simulada)
                // --------------------------------------------------------------
                renderReportes(container) {
                    container.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">üìà Reportes Acad√©micos</h2>
                            </div>
                            <p>Genere reportes individuales o grupales para entrega a direcci√≥n o familias.</p>
                            <div class="grid-3">
                                <button class="btn" id="rep-individual">üë§ Reporte Individual</button>
                                <button class="btn btn-secondary" id="rep-grupo">üë• Reporte de Grupo</button>
                                <button class="btn btn-secondary" id="rep-excel">üì• Exportar a Excel</button>
                            </div>
                        </div>
                    `;
                    document.getElementById('rep-individual')?.addEventListener('click', () => alert('Funci√≥n de reporte individual (simulada)'));
                    document.getElementById('rep-grupo')?.addEventListener('click', () => alert('Funci√≥n de reporte de grupo (simulada)'));
                    document.getElementById('rep-excel')?.addEventListener('click', () => alert('Exportaci√≥n a Excel (simulada)'));
                },
                // --------------------------------------------------------------
                // 7. BIT√ÅCORA DOCENTE (DUA)
                // --------------------------------------------------------------
                renderBitacora(container) {
                    container.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">üìì Bit√°cora Docente (DUA)</h2>
                            </div>
                            <div class="grid-2">
                                <div class="form-group">
                                    <label for="bit-fecha">Fecha</label>
                                    <input type="date" id="bit-fecha" value="${new Date().toISOString().split('T')[0]}">
                                </div>
                                <div class="form-group">
                                    <label for="bit-tema">Tema / Actividad</label>
                                    <input type="text" id="bit-tema" placeholder="Ej: An√°lisis de textos">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="bit-observaciones">Observaciones / Ajustes DUA</label>
                                <textarea id="bit-observaciones" rows="3" placeholder="Describa ajustes realizados..."></textarea>
                            </div>
                            <button class="btn" id="guardar-bitacora">üìù Guardar Registro</button>
                            <div class="table-responsive mt-3">
                                <table>
                                    <thead>
                                        <tr><th>Fecha</th><th>Tema</th><th>Observaciones</th></tr>
                                    </thead>
                                    <tbody id="bitacora-tbody"></tbody>
                                </table>
                            </div>
                        </div>
                    `;
                    // No hay persistencia de bit√°cora en este demo, pero se puede agregar f√°cilmente.
                },
                // --------------------------------------------------------------
                // 8. INSTRUMENTOS (Placeholder)
                // --------------------------------------------------------------
                renderInstrumentos(container) {
                    container.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">üìã Instrumentos de Evaluaci√≥n</h2>
                            </div>
                            <p>M√≥dulo para crear y gestionar r√∫bricas, listas de cotejo y escalas de desempe√±o.</p>
                            <button class="btn">‚ûï Crear Nuevo Instrumento</button>
                        </div>
                    `;
                },
                // --------------------------------------------------------------
                // 9. RESPALDO
                // --------------------------------------------------------------
                renderRespaldo(container) {
                    container.innerHTML = `
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">üíæ Respaldo de Datos</h2>
                            </div>
                            <p>Exporte o importe toda la informaci√≥n del sistema.</p>
                            <div class="grid-2">
                                <button class="btn" id="exportar-json">üì§ Exportar a JSON</button>
                                <button class="btn btn-secondary" id="importar-json">üì• Importar desde JSON</button>
                            </div>
                            <input type="file" id="archivo-json" accept=".json" style="display:none;">
                        </div>
                    `;
                    document.getElementById('exportar-json')?.addEventListener('click', () => {
                        const dataStr = JSON.stringify(ModeloMEP, null, 2);
                        const blob = new Blob([dataStr], { type: 'application/json' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `respaldo_mep_${new Date().toISOString().split('T')[0]}.json`;
                        a.click();
                    });
                    document.getElementById('importar-json')?.addEventListener('click', () => {
                        document.getElementById('archivo-json').click();
                    });
                    document.getElementById('archivo-json')?.addEventListener('change', (e) => {
                        const file = e.target.files[0];
                        if (!file) return;
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            try {
                                const datos = JSON.parse(e.target.result);
                                Object.assign(ModeloMEP, datos);
                                guardarTodo();
                                alert('‚úÖ Datos restaurados correctamente');
                            } catch (error) {
                                alert('‚ùå Error al leer el archivo JSON');
                            }
                        };
                        reader.readAsText(file);
                    });
                }
            };

            window.UI = UI;
            document.addEventListener('DOMContentLoaded', () => UI.init());
        })();
    </script>
</body>
</html>
